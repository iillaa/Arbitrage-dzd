# GitHub Actions Build Troubleshooting Guide

## Common Errors and Solutions

### 1. **Gradle Version Mismatch**
**Error:** `Unsupported class file major version XX`
**Solution:** The workflow now sets Gradle to 8.2 and AGP to 8.1.4

### 2. **Dependency Resolution Errors**
**Error:** `ERESOLVE unable to resolve dependency tree`
**Solution:** 
- Updated workflow uses `npm ci --legacy-peer-deps`
- Updated package.json with compatible Expo SDK 51

### 3. **Out of Memory Errors**
**Error:** `java.lang.OutOfMemoryError: Java heap space`
**Solution:** Workflow now sets `org.gradle.jvmargs=-Xmx4096m`

### 4. **Android SDK Not Found**
**Error:** `ANDROID_HOME is not set`
**Solution:** Added `android-actions/setup-android@v3` step

### 5. **Build Tools Version Errors**
**Error:** `Failed to find Build Tools revision XX`
**Solution:** Expo prebuild with `--clean` flag ensures fresh setup

---

## How to Debug Build Failures

### Step 1: Check GitHub Actions Logs
1. Go to your repository on GitHub
2. Click "Actions" tab
3. Click on the failed workflow run
4. Expand each step to see detailed logs

### Step 2: Look for Specific Error Messages

**Common patterns:**
```
ERROR: Failed to resolve: com.android.tools.build:gradle:X.X.X
```
→ AGP version incompatibility

```
FAILURE: Build failed with an exception.
* What went wrong:
Could not determine the dependencies of task ':app:compileDebugJavaWithJavac'.
```
→ Dependency resolution issue

```
Execution failed for task ':app:mergeDebugResources'.
```
→ Resource conflict or missing resource

### Step 3: Test Locally (if possible)

On your Android device with Termux:
```bash
cd ~/your-project
npm install
npx expo prebuild --platform android --clean
cd android
chmod +x gradlew
./gradlew assembleDebug --stacktrace
```

---

## Updated Files Required

Replace these files in your repository:

1. **`.github/workflows/build-apk.yml`** - Improved workflow
2. **`package.json`** - Updated dependencies
3. **`app.json`** - Ensure correct configuration

---

## app.json Minimal Configuration

```json
{
  "expo": {
    "name": "Arbitrage DZD",
    "slug": "arbitrage-dzd",
    "version": "1.0.0",
    "orientation": "portrait",
    "userInterfaceStyle": "dark",
    "platforms": ["android"],
    "android": {
      "package": "com.kibali.arbitragedzd",
      "versionCode": 1,
      "adaptiveIcon": {
        "backgroundColor": "#0f172a"
      },
      "permissions": []
    }
  }
}
```

---

## Verify Before Committing

1. ✅ All required files present:
   - `App.js`
   - `package.json`
   - `app.json`
   - `.github/workflows/build-apk.yml`
   - All `src/` files

2. ✅ `.gitignore` excludes:
   - `node_modules/`
   - `.expo/`
   - `android/` (generated by prebuild)

3. ✅ No unnecessary files in repository

---

## Alternative: Use Expo EAS Build

If GitHub Actions continues to fail, consider using Expo's EAS Build service:

```bash
# Install EAS CLI
npm install -g eas-cli

# Login to Expo
eas login

# Configure EAS
eas build:configure

# Build APK
eas build --platform android --profile preview
```

This is more reliable but requires an Expo account.

---

## Quick Fix Checklist

- [ ] Updated `.github/workflows/build-apk.yml`
- [ ] Updated `package.json` with compatible versions
- [ ] Verified `app.json` has `android.package` set
- [ ] Committed and pushed changes
- [ ] Triggered workflow manually from Actions tab
- [ ] Checked logs for specific error messages

---

## Contact Info

If you need specific help with error messages, please provide:
1. The full error log from GitHub Actions
2. Your current `package.json` versions
3. Any custom changes to Android configuration